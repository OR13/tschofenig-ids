<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.10 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY I-D.ietf-tls-dtls13 SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-tls-dtls13.xml">
<!ENTITY I-D.ietf-tls-dtls-connection-id SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-tls-dtls-connection-id.xml">
]>

<?rfc rfcedstyle="yes"?>
<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc text-list-symbols="-o*+"?>
<?rfc docmapping="yes"?>

<rfc ipr="pre5378Trust200902" docName="draft-tschofenig-tls-dtls-rrc-01" category="std" updates="6347">

  <front>
    <title abbrev="DTLS Return Routability Check (RRC)">Return Routability Check for DTLS 1.2 and DTLS 1.3</title>
    <author initials="T." surname="Fossati" fullname="Thomas Fossati">
      <organization>Arm Limited</organization>
      <address>
        <email>thomas.fossati@arm.com</email>
      </address>
    </author>
    <author initials="H." surname="Tschofenig" fullname="Hannes Tschofenig" role="editor">
      <organization>Arm Limited</organization>
      <address>
        <email>hannes.tschofenig@arm.com</email>
      </address>
    </author>
    <date year="2020" month="March"/>

    <area>Security</area>
    <workgroup>TLS</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>

<t>This document specifies a return routability check for use in context of the Connection ID (CID) construct for the Datagram Transport Layer Security (DTLS) protocol versions 1.2 and 1.3.</t>

    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>In "classical" DTLS, selecting a security context of an incoming DTLS record
is accomplished with the help of the 5-tuple, i.e. source IP address, source port, transport protocol, destination IP address, and destination port. Changes to this 5 tuple can happen for a variety reasons over the lifetime of the DTLS session. In the IoT context, NAT rebinding is common with sleepy devices. Other examples include end host mobility and multi-homing. Without CID, if the source IP address and/or source port changes during the lifetime of an ongoing DTLS session then the receiver will be unable to locate the correct security context. As a result, the DTLS handshake has to be re-run. Of course, it is not necessary to re-run the full handshake if session resumption is supported and negotiated.</t>

<t>A CID is an identifier carried in the record layer header of a DTLS datagram that gives the receiver additional information for selecting the appropriate security context. The CID mechanism has been specified in <xref target="I-D.ietf-tls-dtls-connection-id"/> for DTLS 1.2 and in <xref target="I-D.ietf-tls-dtls13"/> for DTLS 1.3.</t>


<t>Section 6 of <xref target="I-D.ietf-tls-dtls-connection-id"/> describes how the use of CID increases the attack surface by providing both on-path and off-path attackers an opportunity for (D)DoS.  It then goes on describing the steps a DTLS principal must take when a record with a CID is received that has a source address (and/or port) different from the one currently associated with the DTLS connection.  However, the actual mechanism for ensuring that the new peer address is willing to receive and process DTLS records is left open. This document standardizes a return routability check (RRC) as part of the DTLS protocol itself.</t>

<t>The return routability check is performed by the receiving peer before the CID-to-IP address/port binding is updated in that peer's session state database. This is done in order to provide more confidence to the receiving peer that the sending peer is reachable at the indicated address and port.</t>

</section>
<section anchor="conventions-and-terminology" title="Conventions and Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as shown here.</t>

<t>This document assumes familiarity with the CID format and protocol defined for DTLS 1.2 <xref target="I-D.ietf-tls-dtls-connection-id"/> and for DTLS 1.3 <xref target="I-D.ietf-tls-dtls13"/>.</t>

</section>

<section anchor="rrc" title="The Return Routability Check Message">

<t>When a record with CID is received that has the source address of the enclosing UDP datagram different from the one previously associated with that CID, the receiver MUST NOT update its view of the peer’s IP address and port number with the source specified in the UDP datagram before cryptographically validating the enclosed record(s) but instead perform a return routability check.</t>

<figure><artwork><![CDATA[
      enum {
          invalid(0),
          change_cipher_spec(20),
          alert(21),
          handshake(22),
          application_data(23),
          heartbeat(24),  /* RFC 6520 */
          return_routability_check(TBD), /* NEW */
          (255)
      } ContentType;
]]></artwork></figure>

<figure><artwork><![CDATA[
      struct {
          opaque cookie<1..2^16-1>;
      } Cookie;

      struct {
          Cookie cookie;
      } return_routability_check;
]]></artwork></figure>

<t>The newly introduced return_routability_check message contains a cookie. The semantic of the cookie is similar to the cookie used in the HelloRetryRequest message defined in <xref target="RFC8446"/>.</t>

<t>The return_routability_check message MUST be authenticated and encrypted using the currently active security context.</t>

<t>The receiver that observes the peer's address and or port update MUST stop sending any buffered application data (or limit the sending rate to a TBD threshold) and initiate the return routability check that proceeds as follows:</t>

<t>
  <list style="numbers">
    <t>A cookie is placed in the return_routability_check message;</t>
    <t>The message is sent to the observed new address and a timeout T is started;</t>
    <t> The peer endpoint, after successfully verifying the received return_routability_check message echoes it back;</t>
    <t> When the initiator receives and verifies the return_routability_check message, it updates the peer address binding;</t>
    <t> If T expires, or the address confirmation fails, the peer address binding is not updated.</t>
  </list>
</t>

<t>After this point, any pending send operation is resumed to the bound peer address.</t>

</section>

<section anchor="rrc-example" title="RRC Example">

<t>The example shown in <xref target="fig-example"/> illustrates a client and a server exchanging application payloads protected by DTLS with an unilaterally used CIDs. At some point in the communication interaction the IP address used by the client changes and, thanks to the CID usage, the security context to interpret the record is successfully located by the server.  However, the server wants to test the reachability of the client at his new IP address, to avoid being abused (e.g., as an amplifier) by an attacker impersonating the client.</t>

<figure title="Return Routability Example" anchor="fig-example"><artwork><![CDATA[
   Client                                             Server
   ------                                             ------

   Application Data            ========>
   <CID=100>
   Src-IP=A
   Dst-IP=Z
                               <========        Application Data
                                                    Src-IP=Z
                                                    Dst-IP=A


                           <<------------->>
                           <<   Some      >>
                           <<   Time      >>
                           <<   Later     >>
                           <<------------->>


   Application Data            ========>
   <CID=100>
   Src-IP=B
   Dst-IP=Z

                                          <<< Unverified IP
                                              Address B >>

                               <--------  Return Routability Check
                                                 (cookie)
                                                 Src-IP=Z
                                                 Dst-IP=B

   Return Routability Check    -------->
   (cookie)
   Src-IP=B
   Dst-IP=Z

                                          <<< IP Address B
                                              Verified >>


                               <========        Application Data
                                                    Src-IP=Z
                                                    Dst-IP=B
]]></artwork></figure>

</section>
<section anchor="sec-cons" title="Security and Privacy Considerations">

<t>Note that the return routability checks do not protect against flooding of third-parties if the attacker is on-path, as the attacker can redirect the return routability checks to the real peer (even if those datagrams are cryptographically authenticated). On-path adversaries can, in general, pose a harm to connectivity.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>IANA is requested to allocate an entry to the existing TLS “ContentType” registry, for the return_routability_check(TBD) defined in this document.</t>

</section>
<section anchor="open-issues" title="Open Issues">

<t><list style="symbols">
  <t>Should the return routability check use separate sequence numbers and replay windows?</t>
  <t>Should the heartbeat message be re-used instead of the proposed new message exchange?</t>
</list></t>

</section>


  </middle>

  <back>

    <references title='Normative References'>


<reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor="RFC8446" target='https://www.rfc-editor.org/info/rfc8446'>
<front>
<title>The Transport Layer Security (TLS) Protocol Version 1.3</title>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'><organization /></author>
<date year='2018' month='August' />
<abstract><t>This document specifies version 1.3 of the Transport Layer Security (TLS) protocol.  TLS allows client/server applications to communicate over the Internet in a way that is designed to prevent eavesdropping, tampering, and message forgery.</t><t>This document updates RFCs 5705 and 6066, and obsoletes RFCs 5077, 5246, and 6961.  This document also specifies new requirements for TLS 1.2 implementations.</t></abstract>
</front>
<seriesInfo name='RFC' value='8446'/>
<seriesInfo name='DOI' value='10.17487/RFC8446'/>
</reference>

&I-D.ietf-tls-dtls13;
&I-D.ietf-tls-dtls-connection-id;


<reference  anchor="RFC8174" target='https://www.rfc-editor.org/info/rfc8174'>
<front>
<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
<author initials='B.' surname='Leiba' fullname='B. Leiba'><organization /></author>
<date year='2017' month='May' />
<abstract><t>RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='8174'/>
<seriesInfo name='DOI' value='10.17487/RFC8174'/>
</reference>




    </references>



<section anchor="history" title="History">

<t>RFC EDITOR: PLEASE REMOVE THE THIS SECTION</t>

<t><list style="symbols">
  <t>01: Removed text that overlapped with draft-ietf-tls-dtls-connection-id</t>
  <t>00: Initial version</t>
</list></t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

<t>We would like to thank Achim Kraus, Hanno Becker and Manuel Pegourie-Gonnard for their input to this document.</t>

</section>


  </back>

</rfc>

